<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css">
<title>Vue の場合 (SPA)</title>
</head>
<body class="bg-dark bg-gradient text-light vh-100">
<!-- ========== ヘッダー ========== -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-1">
	<div class="container">
		<a class="navbar-brand" href="..">CRUD サンプル</a>
		<button class="navbar-toggler" type="button"
			data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav me-auto mb-2 mb-lg-0">
				<li class="nav-item"><a class="nav-link" href="../item/list">JSP</a></li>
				<li class="nav-item"><a class="nav-link" href="../spa/react.html">React</a></li>
				<li class="nav-item"><a class="nav-link active" href="../spa/vue.html">Vue</a></li>
			</ul>
			<div class="navbar-text d-flex">
				<span class="me-3" id="id_uesr_name"></span>
				<a class="nav-link active d-none" id="id_logout" href="../logout">ログアウト</a>
			</div>
		</div>
	</div>
</nav>
<!-- ========== メイン (Vue Router 画面遷移部分) ========== -->
<div class="container">
	<div class="alert mb-0" id="id_message" style="min-height:4rem"></div>
	<div id="id_app"><router-view></router-view></div>
</div>
<!-- ========== フッター ========== -->
<footer class="footer fixed-bottom py-3 text-center bg-dark">
	<div class="container">
		<span class="text-muted">New Gradle Project Wizard (c) Pleiades MIT</span>
	</div>
</footer>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-router@4"></script>
<script src="https://cdn.jsdelivr.net/npm/vue3-sfc-loader/dist/vue3-sfc-loader.js"></script>
<script>
// ES6 import 使用時と同じように書けるようにしておく
const { createApp, ref, reactive, onMounted } = Vue;
const { createRouter, createWebHashHistory, useRoute, useRouter } = VueRouter;

// axios 2xx 以外の共通エラー設定
axios.interceptors.response.use(
	response => response,
	error => {id_message.textContent = `❌ 処理できませんでした。 ${error.message} - ${error.config?.url}`}
);
(async() => {
	id_uesr_name.textContent = (await axios.get('user-name')).data;
	if (id_uesr_name.textContent) id_logout.classList.remove('d-none');
})();

// npm を使用せず CDN で Vue SFC (ES6 単一ファイルコンポーネント .vue ファイル) を使えるようにする
const loadVueFile = path => {return window["vue3-sfc-loader"].loadModule(path, {
	moduleCache: {vue: Vue,},
	async getFile(url) {
		const res = await fetch(url);
		return {getContentData: asBinary => asBinary ? res.arrayBuffer() : res.text(),};
	},
	addStyle(textContent) {
		const style = Object.assign(document.createElement("style"), {textContent,});
		const ref = document.head.getElementsByTagName("style")[0] || null;
		document.head.insertBefore(style, ref);
	},
})};

// Vue Router 定義 (createWebHashHistory 使用)
// ・createWebHistory     : URL が切り替わるため、サーバ側で URL マッピングが必要 (同じページを返すようにする)
// ・createWebHashHistory : URL ハッシュで切り替えるため、サーバ側で URL マッピング不要 (だが引数で state を渡せない)
const router = createRouter({
	history: createWebHashHistory(),
	routes: [
		{ path: "/", component: () => loadVueFile('./vue_list.vue') },
		{ path: "/edit/:id", component: () => loadVueFile('./vue_edit.vue') },
	],
});
createApp({}).use(router).mount("#id_app");
</script>
</html>
