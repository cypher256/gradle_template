<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css">
<title>Vue の場合</title>
</head>
<body class="bg-dark bg-gradient text-light vh-100">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-1">
	<div class="container">
		<a class="navbar-brand" href="${ctx}">Servlet CRUD サンプル</a>
		<button class="navbar-toggler" type="button"
			data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav me-auto mb-2 mb-lg-0">
				<li class="nav-item"><a class="nav-link" href="${ctx}/item/list">JSP</a></li>
				<li class="nav-item"><a class="nav-link" href="${ctx}/spa/react.html">React</a></li>
				<li class="nav-item"><a class="nav-link active" href="${ctx}/spa/vue.html">Vue</a></li>
			</ul>
			<div class="navbar-text d-flex ${empty request.remoteUser ? 'd-none' : ''}">
				<span class="me-3">${fn:escapeXml(request.remoteUser)}</span>
				<a class="nav-link active" href="${ctx}/logout">ログアウト</a>
			</div>
		</div>
	</div>
</nav>
<div class="container" id="app_">
	<router-view></router-view>
</div>
<footer class="footer fixed-bottom py-3 text-center bg-dark">
	<div class="container">
		<span class="text-muted">New Gradle Project Wizard (c) Pleiades MIT</span>
	</div>
</footer>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-router@4"></script>
<script src="https://cdn.jsdelivr.net/npm/vue3-sfc-loader/dist/vue3-sfc-loader.js"></script>
<!-- <script src="vue_list.js"></script> -->
<script src="vue_detail.js"></script>
<script>
const { createApp, ref, onMounted } = Vue;
const { createRouter, createWebHashHistory } = VueRouter;

// npm を使用せず CDN で Vue SFC (単一ファイルコンポーネント .vue ファイル) を使えるようにする
const { loadModule } = window["vue3-sfc-loader"];
const options = {
	moduleCache: {vue: Vue,},
	async getFile(url) {
		const res = await fetch(url);
		if (!res.ok) throw Object.assign(new Error(res.statusText + " " + url), { res });
		return {getContentData: (asBinary) => asBinary ? res.arrayBuffer() : res.text(),};
	},
	addStyle(textContent) {
		const style = Object.assign(document.createElement("style"), {textContent,});
		const ref = document.head.getElementsByTagName("style")[0] || null;
		document.head.insertBefore(style, ref);
	},
};

// Vue ルーター定義とマウント
const router = createRouter({
	history: createWebHashHistory(),
	routes: [
//		{ path: "/", component: List },
		{ path: "/", component: () => loadModule('./vue_list.vue', options) },
		{ path: "/detail/:id", component: Detail },
	],
});
createApp({}).use(router).mount("#app_");

// axios 2xx 以外の共通エラー設定
axios.interceptors.response.use(
	response => response,
	error => {message_.textContent = `❌ 処理できませんでした。 ${error.message} - ${error.config.url}`}
);
</script>
</html>
